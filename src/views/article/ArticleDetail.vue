<template>
  <div class="article-detail page-content">
    <div class="content">
      <h1>{{ articleTitle }}</h1>
      <!--      <div class="markdown-body" v-highlight v-html="articleHtml"></div>-->
      <MdPreview v-model="content" />
      <MdPreview :modelValue="content" />
      <MdCatalog :editorId="state.id" scrollElement=".category" :theme="state.theme" />
    </div>
    <BackToTop />
  </div>
</template>

<script setup lang="ts">
  import '@/assets/styles/markdown.scss'
  import '@/assets/styles/one-dark-pro.scss'
  import { ApiStatus } from '@/utils/http/status'
  import BackToTop from '@comps/Widgets/BackToTop.vue'
  import axios from 'axios'
  import { MdPreview, MdCatalog } from 'md-editor-v3';
  import 'md-editor-v3/lib/preview.css';
  // import 'highlight.js/styles/atom-one-dark.css';
  // import 'highlight.js/styles/vs2015.css';
  // import { ArticleService } from '@/api/articleApi'

  const articleId = ref(0)
  const router = useRoute()
  const articleTitle = ref('')
  const content = ref('')
  const state = reactive({
    theme: 'dark',
    text: '标题',
    id: 'my-editor'
  });
  const scrollElement = document.documentElement;

  onMounted(() => {
    scrollToTop()
    articleId.value = Number(router.query.id)
    getArticleDetail()
  })

  const getArticleDetail = async () => {
    let articleContent:string = '**准备**\n\n1. 一台至少2核4g的服务器（项目系统CentOS7）\n2. 安装git的本机\n\n**后端：**\n\n1. MySQL 8.0\n2. Redis >= 7.2.3\n3. RabbitMQ Latest\n# 1.环境准备\n![](https://image.kuailemao.xyz/blog/article/articleImage/0b1ff987-f414-4a2a-ae72-bad566d63e5a.png)\n\n\n## 1.1.安装Docker\n官方网站地址：[https://docs.docker.com/engine/install/#server](https://docs.docker.com/engine/install/#server)\n**命令：**\n> **下载所需工具包**\n\n```shell\nsudo yum install -y yum-utils\n```\n> **设置阿里云镜像源**\n\n```shell\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n```\n> **安装 Docker Engine(遇到选择一路按y回车)**\n\n```shell\nsudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n> **启动 Docker 服务**\n\n```shell\n sudo systemctl start docker\n```\n> **测试是否安装成功(正确显示版本表示安装成功)**\n\n```shell\ndocker -v\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/0c981758-2b87-4e74-835d-60f4145c11b3.png)\n\n### 设置国内镜像\n```bash\nvi  /etc/docker/daemon.json\n```\n添加\n```bash\n{\n    "registry-mirrors": [\n    "https://mirror.ccs.tencentyun.com",\n    "https://hub.uuuadc.top",\n    "https://docker.anyhub.us.kg",\n    "https://dockerhub.jobcher.com",\n    "https://dockerhub.icu",\n    "https://docker.ckyl.me",\n    "https://docker.awsl9527.cn",\n    "https://docker.m.daocloud.io"\n    ],\n    "live-restore": true\n}\n\n```\n或者\n```bash\n{\n  "registry-mirrors": [\n    "https://docker.1ms.run",\n    "https://docker.m.daocloud.io",\n    "https://docker.1panel.top"\n  ],\n    "live-restore": true\n}\n```\n\n依次执行以下命令，重新启动 Docker 服务。\n```bash\nsystemctl daemon-reload\nservice docker restart\n```\n检查是否生效\n```bash\ndocker info\n```\n是否有以下信息：\n![](https://image.kuailemao.xyz/blog/article/articleImage/68a90550-6d48-4290-88c9-483091c3fa4a.png)\n\n### 安装 Docker Compose\n> 我们一般都是通过docker compose来安装中间件，所以这个必不可少。会比较慢，可手动下载\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/19ff922d-12a9-4d56-82c8-d8c45b781950.png)\n\n下载地址：[https://github.com/docker/compose/releases/download/1.28.6/docker-compose-Linux-x86_64](https://github.com/docker/compose/releases/download/1.28.6/docker-compose-Linux-x86_64)\n下载后执行命令 ：\n```bash\ncd /usr/local/bin\nrz #直接通过rz导入文件\n```\n将可执行权限应用于二进制文件：\n```bash\nsudo chmod +x /usr/local/bin/docker-compose\n```\n测试是否安装成功：\n```bash\ndocker-compose --version\n```\nps：记住把文件的名字改为：docker-compose\n![](https://image.kuailemao.xyz/blog/article/articleImage/228c283e-5b96-4de2-a3cc-feb560dae5ea.png)\n\n### 1.1.1.遇到问题\n\n1. 报错 Error: Nothing to do\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/329c5dc2-3e09-48aa-98e3-4712c4231829.png)\n\n#### 解决办法，更新yum源：\n```shell\nyum -y update\n```\n## 1.2.部署Mysql\n> 创建挂载目录\n\n```bash\n#创建挂载目录\nmkdir -p /data/mysql/data;\nmkdir -p /data/mysql/conf;\n```\n> 创建yml文件\n\n```bash\nvim /data/mysql/docker-compose.yml\n```\n填入配置\n```bash\nversion: \'3\'\nservices:\n  mysql:\n    image: mysql:8.0 #mysql版本\n    container_name: mysql\n    volumes:\n      - /data/mysql/data:/var/lib/mysql\n      - /data/mysql/conf/my.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf\n    restart: always\n    ports:\n      - 3306:3306\n    environment:\n      MYSQL_ROOT_PASSWORD: 123456 #root用户密码\n      TZ: Asia/Shanghai\n    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\n```\n创建配置文件\n```bash\nvim /data/mysql/conf/my.cnf\n```\n```bash\n[mysqld]\ndefault-storage-engine=INNODB  # 创建新表时将使用的默认存储引擎\ncharacter-set-server=utf8mb4      # 设置mysql服务端默认字符集\npid-file        = /var/run/mysqld/mysqld.pid  # pid文件所在目录\nsocket          = /var/run/mysqld/mysqld.sock # 用于本地连接的socket套接字\ndatadir         = /var/lib/mysql              # 数据文件存放的目录\nsymbolic-links=0\nsql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION # 定义mysql应该支持的sql语法，数据校验等!\n\n# 允许最大连接数\nmax_connections=200\n\n\n# 同一局域网内注意要唯一\nserver-id=3306\n# 开启二进制日志功能 & 日志位置存放位置`/var/lib/mysql`\n#log-bin=mysql-bin\nlog-bin=/var/lib/mysql/mysql-bin\n# binlog格式\n# 1. STATEMENT：基于SQL语句的模式，binlog 数据量小，但是某些语句和函数在复制过程可能导致数据不一致甚至出错；\n# 2. MIXED：混合模式，根据语句来选用是 STATEMENT 还是 ROW 模式；\n# 3. ROW：基于行的模式，记录的是行的完整变化。安全，但 binlog 会比其他两种模式大很多；\nbinlog_format=ROW\n# FULL：binlog记录每一行的完整变更 MINIMAL：只记录影响后的行\nbinlog_row_image=FULL\n# 日志文件大小\nmax_binlog_size=100M\n# 定义清除过期日志的时间(这里设置为7天)\nexpire_logs_days=7\n\n# ================= ↑↑↑ mysql主从同步配置end ↑↑↑ =================\n\n[mysql]\ndefault-character-set=utf8mb4\n\n[client]\ndefault-character-set=utf8mb4  # 设置mysql客户端默认字符集\n```\n到对应目录下启动容器\n```bash\ncd /data/mysql\ndocker-compose up -d\n```\n> 看见以下信息代表成功\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/775ba3fd-3caa-4811-b630-0e1cdcead3ef.png)\n\n**记得防火墙开对应的端口号 !!!**\n**一定要记得换端口和复杂密码，不然等着被比特币勒索！！！**\n> **navicate测试链接成功**\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/2598f8ff-1d7f-4e89-ab17-633f095190eb.png)\n\n**最后新建一个数据库，把项目目录下的sql文件放进去运行！！！**\n![](https://image.kuailemao.xyz/blog/article/articleImage/b70a9580-d19a-41d1-9fc9-4074831172bd.png)\n\n## 1.3.部署Redis\n创建挂载目录\n```bash\n#创建挂载目录\nmkdir -p /data/redis\n```\n创建yml文件\n```bash\nvim /data/redis/docker-compose.yml\n```\n填入配置\n```bash\nversion: \'3\'\nservices:\n  redis:\n    image: redis:7.2.3\n    container_name: redis\n    restart: always\n    ports:\n      - 6379:6379\n    volumes:\n      - /data/redis/redis.conf:/etc/redis/redis.conf\n      - /data/redis/data:/data\n      - /data/redis/logs:/logs\n    command: ["redis-server","/etc/redis/redis.conf"]\n```\n创建挂载的配置文件\n```bash\nvim /data/redis/redis.conf\n```\n```bash\nprotected-mode no\nport 6379\ntimeout 0\n#rdb配置\nsave 900 1\nsave 300 10\nsave 60 10000\nrdbcompression yes\ndbfilename dump.rdb\ndir /data\nappendonly yes\nappendfsync everysec\n#设置你的redis密码\nrequirepass 123456\n```\n**注意：protected-mode no 不加，无法连接！**\n到对应目录下启动容器\n```bash\ncd /data/redis\ndocker-compose up -d\n#如果需要强制重新构建\ndocker-compose up --force-recreate -d\n```\n记得防火墙开启对应的端口！！！\n![](https://image.kuailemao.xyz/blog/article/articleImage/d3939ef1-96af-4c5a-9820-70db419b5237.png)\n\n使用工具测试连接\n![](https://image.kuailemao.xyz/blog/article/articleImage/abc9b264-4819-48c3-8c90-6f6255f871ce.png)\n\n## 1.4.部署RabbitMQ\n安装镜像\n```bash\ndocker pull rabbitmq\n```\n根据下载的镜像创建和启动容器\n```bash\ndocker run -d --hostname my-rabbit --name rabbit -p 15672:15672 -p 5672:5672 rabbitmq\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/6d930930-e1ac-4b20-8a31-6f65981fd88f.png)\n\n参数说明：\n```\n-d 后台运行容器；\n--name 指定容器名；\n-p 指定服务运行的端口（5672：应用访问端口；15672：控制台Web端口号）；\n-v 映射目录或文件；\n--hostname  主机名（RabbitMQ的一个重要注意事项是它根据所谓的 “节点名称” 存储数据，默认为主机名）；\n-e 指定环境变量；（RABBITMQ_DEFAULT_VHOST：默认虚拟机名；RABBITMQ_DEFAULT_USER：默认的用户名；RABBITMQ_DEFAULT_PASS：默认用户名的密码）\n```\n查看正在运行容器\n```bash\ndocker ps\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/db9ebac8-e0ab-4057-968b-9f9117f89e98.png)\n\n进入容器内部\n> 比如我自己的：docker exec -it a78657b2e2e1 /bin/bash\n\n```bash\ndocker exec -it 容器id /bin/bash\n```\n运行web插件\n```bash\nrabbitmq-plugins enable rabbitmq_management\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/a4cfe25c-3ee0-404e-8544-8218cb2f9b79.png)\n\n浏览器运行\n> http://ip:15672/\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/6b2830ae-d24a-4c0b-8f8c-bab0cb311c9b.png)\n\n默认用户名和密码是**guest**\n![](https://image.kuailemao.xyz/blog/article/articleImage/38293f4d-ffaa-4e54-9c20-6bb398f8c4cd.png)\n\n解决：⚠ All stable feature flags must be enabled after completing an upgrade. [Learn more]\n> 全部启用\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/1eeda639-8c0f-42fe-a70f-40882d2ee22a.png)\n\n解决不显示图表问题\n> 正常首页应该是这样\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/45b1c9ab-733c-4fcb-9299-e591e8764dee.png)\n\n**解决方法：**\n\n1. 查看所有容器（看id）\n```bash\ndocker ps -a\n```\n\n2. 进入容器内部\n```bash\ndocker exec -it 容器id /bin/bash\n```\n\n3. 进入指定目录\n```bash\ncd /etc/rabbitmq/conf.d/\n```\n\n4. 修改 management_agent.disable_metrics_collector = false\n```bash\necho management_agent.disable_metrics_collector = false > management_agent.disable_metrics_collector.conf\n```\n\n5. 退出容器\n```bash\nexit\n```\n\n6. 重启容器\n```bash\ndocker restart 容器Id\n```\n**修改密码：**\n\n1. 进入容器内部\n2. 查看RabbitMQ当前的用户列表\n```bash\nrabbitmqctl list_users\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/a8c0d6bd-7e8a-4d72-995d-f0453dbcae17.png)\n\n\n3. 修改密码\n```bash\nrabbitmqctl change_password 用户名 \'[密码]\'\n```\n## 1.5.部署Minio\n创建挂载目录\n```bash\n#创建挂载目录\nmkdir -p /data/minio\n```\n创建yml文件\n```bash\nvim /data/minio/docker-compose.yml\n```\n填入配置\n```bash\nversion: \'3\'\nservices:\n  minio:\n    image: "minio/minio"\n    container_name: minio\n    ports:\n      - "9000:9000" # api 端口\n      - "9001:9001" # 控制台端口\n    environment:\n      MINIO_ROOT_USER: admin # 管理后台用户名\n      MINIO_ROOT_PASSWORD: 12345678 # 管理后台密码，最小8个字符\n      MINIO_COMPRESS: "off" # 开启压缩 on 开启 off 关闭\n      MINIO_COMPRESS_EXTENSIONS: "" # 扩展名 .pdf,.doc 为空 所有类型均压缩\n      MINIO_COMPRESS_MIME_TYPES: "" # mime 类型 application/pdf 为空 所有类型均压缩\n    volumes:\n      - /data/minio/data:/data/ # 映射当前目录下的data目录至容器内/data目录\n      - /data/minio/config:/root/.minio/ # 映射配置目录\n    command: server --address \':9000\' --console-address \':9001\' /data  # 指定容器中的目录 /data\n    privileged: true\n```\n到对应目录下启动容器\n```bash\ncd /data/minio\ndocker-compose up -d\n#如果需要强制重新构建\ndocker-compose up --force-recreate -d\n```\n打开对应的控制台: http://ip:9001/\n**记得服务器防火墙开启9000，9001端口！！！使用对应的账号密码登录！**\n![](https://image.kuailemao.xyz/blog/article/articleImage/a3e027a5-e707-4e7d-9e99-c71f92d7b680.png)\n\n创建一个对应的桶\n![](https://image.kuailemao.xyz/blog/article/articleImage/0f978437-a6e4-47d7-bc0c-80d83d88b647.png)\n\n设置访问权限\n![](https://image.kuailemao.xyz/blog/article/articleImage/69d52702-4b61-4dc5-a518-0483df391797.png)\n\n填写\n```\n{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": [\n                    "*"\n                ]\n            },\n            "Action": [\n                "s3:GetBucketLocation"\n            ],\n            "Resource": [\n                "arn:aws:s3:::blog"\n            ]\n        },\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": [\n                    "*"\n                ]\n            },\n            "Action": [\n                "s3:ListBucket"\n            ],\n            "Resource": [\n                "arn:aws:s3:::blog"\n            ],\n            "Condition": {\n                "StringEquals": {\n                    "s3:prefix": [\n                        "*"\n                    ]\n                }\n            }\n        },\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": [\n                    "*"\n                ]\n            },\n            "Action": [\n                "s3:GetObject"\n            ],\n            "Resource": [\n                "arn:aws:s3:::blog/**"\n            ]\n        }\n    ]\n}\n```\n创建密钥\n> 密钥只要第一次可见，创建后记得保存好\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/2f42813f-8a36-4571-84c8-4fdee368e87f.png)\n\n## 1.6.部署音乐后端\n\n1. 拉取镜像\n```bash\ndocker pull binaryify/netease_cloud_music_api\n```\n\n2. 运行\n```bash\ndocker run -p 3000:3000 --name netease_cloud_music_api -d binaryify/netease_cloud_music_api\n```\n记得服务器防火墙开启对应端口！！！\n\n## 1.7.部署一言接口\n> 可选，官网的一言接口有qps限制，想使用流畅一点就自己部署一个\n\n官方部署文档：[https://developer.hitokoto.cn/sentence/deploy.html](https://developer.hitokoto.cn/sentence/deploy.html)\n\n**一言官方提供了各种部署方式，自己选一个，官网使用 `Docker` 部署**\n\n\n# 2.申请第三方登录\n## 2.1.Gitee\n> 设置 > 第三方应用\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/c08dcd77-c824-4dea-9c2b-ecda9d49c799.png)\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/0e338b34-c031-448e-a7c1-d85e732cac34.png)\n\n应用回调地址\n```bash\nhttp://[后端地址]:[端口]/oauth/gitee/callback\n```\n## 2.2.Github\n> Settings/Developer Settings >   OAuth Apps\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/a290e926-30cc-4857-a087-50986677b46f.png)\n\n回调地址填写方式与Gitee一致，记得生成密钥后保存，只有第一次可见！！！\n# 3.申请邮件发送\n## 3.1.QQ\n> 邮箱设置找到 **POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务，**去开启服务，得到密钥\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/1daeef8a-1735-4290-ba4c-b4d40e763525.png)\n\n## 3.2.163\n> 进入设置，找到 **POP3/SMTP/IMAP**\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/3c3ce258-8c4e-4221-b008-6106329b0d4e.png)\n\n**ps：** 可以先申请 `IMAP/SMTP服务` 试一下是否可行，不行就使用另外一个\n# 4.本地运行项目\n## 4.1.拉取项目\n> 项目地址：[kuailemao/Ruyu-Blog](https://gitee.com/kuailemao/ruyu-blog)\n\n小白请下载最新的发行版本\n![](https://image.kuailemao.xyz/blog/article/articleImage/b463f357-602b-4551-be81-a23141540233.png)\n\n**命令：**\n```shell\ngit clone git@gitee.com:kuailemao/ruyu-blog.git\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/bef26efa-f4ea-4015-a606-3f05ebff132e.png)\n\n## 4.2.运行后端\n使用idea打开，下载后端依赖\n![](https://image.kuailemao.xyz/blog/article/articleImage/3344c3a6-57b2-4216-b476-132d6f62bac5.png)\n\nresources目录下新建application-dev.yml\n![](https://image.kuailemao.xyz/blog/article/articleImage/20842613-037f-4b6d-b573-430f57a4cde6.png)\n\n添加配置\n**注意：** <u>最新配置以你自己拉取的配置文件为主，这里的配置可能与你拉取的版本不同</u>\n\n```latex\nspring:\n  security:\n    jwt:\n      key: jwt-key\n      # jwt 的有效时间（天）\n      expire: 7\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://[数据库IP]:[数据库端口]/blog?useSSL=false&allowPublicKeyRetrieval=true\n    username: root\n    password: [数据库密码]\n  data:\n    redis:\n      # redis 端口\n      port: 6379\n      # redis 地址\n      host:\n      # redis 密码\n      password:\n      # redis连接超时时间（毫秒）\n      timeout: 10000\n      # 数据库索引，默认为0\n      database: 1\n  jackson:\n    date-format: yyyy-MM-dd HH:mm:ss\n    time-zone: GMT+8\n  rabbitmq:\n    # rabbitmq 地址\n    host:\n    # rabbitmq 端口\n    port: 5672\n    # rabbitmq 用户名\n    username:\n    # rabbitmq 密码\n    password:\n    listener:\n      simple:\n        retry:\n          enabled: true #是否开启消费者重试\n          max-attempts: 3 #最大重试次数\n          initial-interval: 6000 #重试间隔时间（单位毫秒）\n          multiplier: 2 #间隔时间乘子，间隔时间*乘子=下一次的间隔时间，最大不能超过设置的最大间隔时间\n          max-interval: 10000 #重试最大时间间隔（单位毫秒）\n    # 邮箱队列名称\n    queue:\n      email: email_queue\n      log-login: log_login_queue\n      log-system: log_system_queue\n    # 邮箱交换机名称\n    exchange:\n      email: email_exchange\n      log: log_exchange\n    # 邮箱路由键\n    routingKey:\n      email: email_routing_key\n      log-login: log_routing_key_login\n      log-system: log_routing_key_system\n  mail:\n    host: smtp.qq.com\n    username:  # 不可透露，邮件发送账号\n    password:  # 不可透露，邮件发送账号密钥\n    chat-gpt:\n      email:  # 不可透露\n      password:  # # 不可透露\n    properties:\n      mail.smtp.auth: true\n      mail.smtp.starttls.enable: true\n  servlet:\n    multipart:\n      max-file-size: 10MB\n      max-request-size: 10MB\n  quartz:\n    # 将 Quartz 持久化方式修改为 jdbc\n    job-store-type: jdbc\n    properties:\n      org:\n        quartz:\n          scheduler:\n            # 实例节点 ID 自动生成\n            instanceId: AUTO\n          jobStore:\n            class: org.quartz.impl.jdbcjobstore.JobStoreTX\n            dataSource: quartz_jobs\n          dataSource:\n            quartz_jobs:\n              driver: com.mysql.cj.jdbc.Driver\n              URL: jdbc:mysql://[数据库IP]:[数据库端口]/blog?useSSL=false&allowPublicKeyRetrieval=true\n              user: root\n              password: [数据库密码]\nmybatis:\n  mapper-locations: classpath:mapper/*.xml\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\nmybatis-plus:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n  global-config:\n    db-config:\n      # 逻辑删除\n      logic-delete-field: isDeleted\n      # 逻辑删除值\n      logic-delete-value: 1\n      # 逻辑未删除值\n      logic-not-delete-value: 0\n      # id 自增\n      id-type: auto\n# springdoc-openapi项目配置，访问 http://127.0.0.1:8088/doc.html\nspringdoc:\n  swagger-ui:\n    path: /swagger-ui.html\n    tags-sorter: alpha\n    operations-sorter: alpha\n  api-docs:\n    path: /v3/api-docs\n  group-configs:\n    - group: \'default\'\n      paths-to-match: \'/**\'\n      packages-to-scan: xyz.kuailemao\noauth:\n  # gitee 登录\n  gitee:\n    client-id:\n    client-secret:\n    redirect-uri:\n  # gitub 登录\n  github:\n    client-id:\n    client-secret:\n    redirect-uri:\nweb:\n  index:\n    # 网站前端首页\n    path: http://kuailemao.xyz/\n# knife4j的增强配置，不需要增强可以不配\nknife4j:\n  enable: true\n  setting:\n    language: zh_cn\nhttp_pool:\n  max_total: 200\n  default_max_per_route: 100\n  connect_timeout: 5000\n  connection_request_timeout: 1000\n  socket_timeout: 65000\n  validate_after_inactivity: 2000\n# 连接 minio\nminio:\n  # 访问地址\n  endpoint:\n  accessKey:\n  secretKey:\n  # 桶名称\n  bucketName:\n```\n**把上面准备好的环境找到对应的地方配置好各种ip跟端口或者密钥**\n\n看到以下信息，恭喜你，后端启动成功！\n![](https://image.kuailemao.xyz/blog/article/articleImage/58b3d367-f4df-46b2-a926-2b1b64340789.png)\n\n## 4.3.运行前端\n**前提具备条件：**\n\n- pnpm >= 8.12.0\n- node >= 16.17.0\n### 4.3.1.运行前台\n\n1. 找到打开 `kuailemao-blog` 目录\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/84bb99df-fd2c-4ea1-b171-36d5b5f74530.png)\n\n**右键打开终端**\n![](https://image.kuailemao.xyz/blog/article/articleImage/c5a30281-50d7-4b1c-a7e1-16a7abb7c296.png)\n\n运行命令\n```bash\npnpm install\npnpm run dev\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/e2400a16-2b68-4b1e-932f-d25c11c79082.png)\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/20df1734-87ff-401f-a3d6-9fdb29b5a81f.png)\n\n看到访问链接后恭喜你运行成功！！！\n![](https://image.kuailemao.xyz/blog/article/articleImage/a437f3bf-8e6e-4691-99ce-811b3f0d0c59.png)\n\n**效果如上，简单吧（滑稽）**\n### 4.3.2.运行后台\n与上面同样的方式，找到`kuailemao-admin`文件夹，打开终端\n**运行命令：**\n```bash\npnpm install\npnpm dev\n```\n看到访问路径表示运行成功\n![](https://image.kuailemao.xyz/blog/article/articleImage/7343fb44-80e8-41d4-8fde-217a867d9b4a.png)\n\n**效果如下：**\n![](https://image.kuailemao.xyz/blog/article/articleImage/28435382-530a-44aa-ac20-eb886ce329bd.png)\n\n### 4.3.3.音乐模块\n开源地址：[https://github.com/XiangZi7/KM-Music-Player](https://github.com/XiangZi7/KM-Music-Player)\n> 这个页面是单独部署的并非集成在项目内，需要的自己参考开源大佬的文档部署\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/56edb3d9-5efb-4969-885b-7a8fff2111c1.png)\n\n# 5.部署\n## 5.1.部署后端\n### 5.1.1.项目打包\nidea运行打包命令\n![](https://image.kuailemao.xyz/blog/article/articleImage/d6ee0859-3a57-4906-971d-258bfee45fb6.png)\n\n得到一个打包好的Jar包\n![](https://image.kuailemao.xyz/blog/article/articleImage/d876b54d-88ff-4a8a-a746-080c4982dda6.png)\n\n### 5.1.2.服务器部署\n新建文件夹后进入\n```bash\nmkdir /blog/backend\ncd /blog/backend\n```\n上传打包文件\n```bash\nrz  # Enter\n```\n> 把你打包好的后端Jar包上传\n\n新建 Dockerfile\n```bash\nvim Dockerfile\n```\n填入配置\n```bash\n# 使用官方的OpenJDK 17镜像作为基础镜像\nFROM openjdk:17\n\n# 设置工作目录\nWORKDIR /app\n\n# 复制项目的jar文件到容器中\nCOPY blog-backend-0.0.1-SNAPSHOT.jar /app/app.jar\n\n# 暴露应用运行的端口\nEXPOSE 8088\n\n# 运行Spring Boot应用\nENTRYPOINT ["java", "-jar", "/app/app.jar"]\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/11602ba7-f5cf-4cd6-a128-b669541968c3.png)\n\n构建镜像\n```bash\ndocker build . -t ruyu-blog-hd\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/d34fca48-ca22-4894-93e6-d903db2424a0.png)\n\n运行\n```bash\ndocker run --name ruyu-blog-hd -d -p 8088:8088 ruyu-blog-hd\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/79f6a4e2-ae14-4f80-a807-b5042bae2d66.png)\n\n检查是否成功\n```bash\ndocker ps\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/2cc9c110-f5ec-41ba-babb-6a238f520766.png)\n\n**记得服务器防火墙开启对应端口！！！**\n## 5.2.部署前台\n找到 kuailemao-blog 目录下面的生产环境配置文件\n![](https://image.kuailemao.xyz/blog/article/articleImage/f37c5b7a-4311-4085-9b68-812d72789fdf.png)\n\nVITE_SERVE：项目后端地址\nVITE_FRONTEND_URL：前台域名（没有配就填写正确ip）\nVITE_MUSIC_SERVE：音乐播放器的后端地址\nVITE_MUSIC_FRONTEND_URL：音乐模块的前端地址（没有就不填写，把音乐模块去掉）\n部署前测试\n> 先在 .env.development 开发环境中，使用部署好的后端尝试是否能正确运行\n\n测试没问题，**打包**：\n### 5.2.1.项目**打包**\n> 使用上面方法在 kuailemao-blog 目录下打开 cmd 终端\n\n运行打包命令\n```bash\npnpm build\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/4f52cb13-5947-4538-8d6e-4a151dc90d92.png)\n\n等待打包完成，根目录下面出现 dist 命令\n![](https://image.kuailemao.xyz/blog/article/articleImage/85008907-98f7-4772-b923-0011613a2461.png)\n\n### 5.2.2.项目部署\n回到服务器，运行命令\n```bash\nmkdir /blog/blog-qt\ncd /blog/blog-qt/\n```\n把打包好的 dist 文件夹上传\n```bash\nrz\n```\n新建 Dockerfile\n```bash\nvim Dockerfile\n```\n填入配置\n```bash\nFROM nginx\n\nMAINTAINER 博客前台\n\nRUN rm /etc/nginx/conf.d/default.conf\n\nADD default.conf /etc/nginx/conf.d/\n\nCOPY dist/ /usr/share/nginx/html/\n\n```\n新建 nginx 配置文件\n```bash\nvim default.conf\n```\n填入配置\n```bash\n# 定义HTTP服务器\n    server {\n        listen 80;              # 监听端口\n\n        server_name localhost;    # 域名\n\n        location / {\n             root   /usr/share/nginx/html;\n             index  index.html index.htm;\n             try_files $uri $uri/ /index.html =404;\n        }\n\n        # 配置代理路径\n        location /api/ {\n            proxy_pass http://[域名/ip+端口]/;        # 转发请求的目标地址\n            proxy_set_header Host $host;             # 设置请求头中的Host字段\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                            # 设置HTTP头中的X-Forwarded-For字段，表示客户端真实IP，多个IP用逗号隔开\n            proxy_set_header X-Real-IP $remote_addr; # 设置请求头中的X-Real-IP字段，表示客户端真实IP\n        }\n\n        # 配置代理路径\n        location /wapi/ {\n            proxy_pass http://[域名/ip+端口]/;        # 转发请求的目标地址，音乐后端\n        }\n\n        # 配置错误页面\n        error_page 404 /404.html;           # 404错误页\n        location = /404.html {\n            internal;                       # 不接受外部访问\n            root /usr/share/nginx/html;     # 404错误页文件所在目录\n        }\n    }\n```\n如果有域名，并且后台不想使用另外一个端口访问，假如 88，因为服务器只有一个 80端口，就可以使用nginx转发，如下配置\n```bash\n# 定义HTTP服务器\n    server {\n        listen 80;              # 监听端口\n\n        server_name kuailemao.xyz;    # 域名\n\n        location / {\n             root   /usr/share/nginx/html;\n             index  index.html index.htm;\n             try_files $uri $uri/ /index.html =404;\n        }\n\n        # 配置代理路径\n        location /api/ {\n            proxy_pass http://[域名/ip+端口]/;        # 转发请求的目标地址，项目后端\n            proxy_set_header Host $host;             # 设置请求头中的Host字段\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                            # 设置HTTP头中的X-Forwarded-For字段，表示客户端真实IP，多个IP用逗号隔开\n            proxy_set_header X-Real-IP $remote_addr; # 设置请求头中的X-Real-IP字段，表示客户端真实IP\n        }\n\n        # 配置代理路径\n        location /wapi/ {\n            proxy_pass http://[域名/ip+端口]/;        # 转发请求的目标地址，音乐后端\n        }\n\n        # 配置错误页面\n        error_page 404 /404.html;           # 404错误页\n        location = /404.html {\n            internal;                       # 不接受外部访问\n            root /usr/share/nginx/html;     # 404错误页文件所在目录\n        }\n    }\n\n    # 二级域名反向代理，访问后台\n    server {\n        listen 80;\n        server_name blog.kuailemao.xyz;\n\n        location / {\n            proxy_pass http://kuailemao.xyz:81/; # 实际的后台路径\n            client_max_body_size 100M;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n    }\n```\n**使用第二种方法记得服务器那边也要解析二级域名！！！**\n![](https://image.kuailemao.xyz/blog/article/articleImage/3eefe4e3-ae52-473d-ab45-5838ed9a4162.png)\n\n如果部署的是v1.4.0版本前端引入了gzip压缩需要在nginx里面也配置(http的内层/server的内层)\n```text\n    gzip on;  # 启用 Gzip 压缩\n    gzip_disable "msie6";  # 禁用 IE6 的 Gzip 压缩\n\n    gzip_vary on;  # 在响应头中添加 Vary: Accept-Encoding\n    gzip_proxied any;  # 压缩代理服务器的响应\n\n    gzip_comp_level 6;  # 压缩级别（1-9，默认值为 1）\n    gzip_buffers 16 8k;  # 压缩缓冲区大小\n    gzip_http_version 1.1;  # 启用 Gzip 的 HTTP 版本\n\n    gzip_types text/plain text/css application/json application/javascript text/xml application/xml+rss text/javascript image/svg+xml;  # 要压缩的文件类型\n```\n\n构建镜像\n```bash\ndocker build . -t blog-qt\n```\n运行\n```bash\ndocker run --name blog-qt -d -p 80:80 blog-qt\n```\n测试是否成功\n```bash\ndocker ps\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/267dbded-982e-43fc-a8d4-b56b005355a3.png)\n\n前台效果\n![](https://image.kuailemao.xyz/blog/article/articleImage/eb295e1d-0eca-4d8a-a9ca-97763df660be.png)\n\n二级域名反向代理，后台访问效果\n![](https://image.kuailemao.xyz/blog/article/articleImage/5f57a5be-f833-4e4c-8562-2c1da0ae5000.png)\n\n## 5.3.后台部署\n找到对应的生产环境配置文件\n![](https://image.kuailemao.xyz/blog/article/articleImage/7d7f6d1c-edec-4ef2-bf7e-30ee23e970e4.png)\n\nVITE_APP_BASE_URL：后端地址\nVITE_APP_DOMAIN_NAME：文件上传地址，也就是 minio 地址，使用9000端口\n**测试**\n> 可以根前台一样先把开发环境配置(.env.development)改成服务器的配置，测试是否可以正确使用\n\n### 5.3.1.项目打包\n打包命令\n```bash\npnpm build\n```\n看见以下信息后表示打包成功\n![](https://image.kuailemao.xyz/blog/article/articleImage/78315543-137c-4374-aaa1-b40fa0e9a1ec.png)\n\n![](https://image.kuailemao.xyz/blog/article/articleImage/aa5a73e8-0f1c-41e2-bc78-78059e938f64.png)\n\n### 5.3.2.后台部署\n回到服务器，运行命令\n```bash\nmkdir /blog/blog-ht\ncd /blog/blog-ht\n```\n**使用 rz 把打包好的 dist 文件上传到该目录**\n新建 Dockerfile\n```bash\nvim Dockerfile\n```\n填入配置\n```bash\nFROM nginx\n\nMAINTAINER 博客后台\n\nRUN rm /etc/nginx/conf.d/default.conf\n\nADD default.conf /etc/nginx/conf.d/\n\nCOPY dist/ /usr/share/nginx/html/\n\n```\n新建 default.conf 配置文件\n```bash\nvim default.conf\n```\n填入配置\n```bash\nserver {\n    listen 81;\n    server_name  _;\n    # gzip config\n    gzip on;\n    gzip_min_length 1k;\n    gzip_comp_level 9;\n    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;\n    gzip_vary on;\n    gzip_disable "MSIE [1-6]\\.";\n\n    root /usr/share/nginx/html;\n    include /etc/nginx/mime.types;\n\n    location / {\n        try_files $uri $uri/ /index.html;\n    }\n\n    location /api/ {\n        proxy_pass http://[域名/ip+端口]/;  # 项目后端地址\n        client_max_body_size 100M;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/91a09b37-a4c6-45cf-b527-2f1985a573a4.png)\n\n构建镜像\n```bash\ndocker build . -t blog-ht\n```\n运行\n```bash\ndocker run --name blog-ht -d -p 81:81 blog-ht\n```\n检查是否运行成功\n```bash\ndocker ps\n```\n![](https://image.kuailemao.xyz/blog/article/articleImage/cdf493bb-d8a3-4b3e-a52e-86ecb482a7a7.png)\n\n查看效果\n![](https://image.kuailemao.xyz/blog/article/articleImage/3bb39afd-00bb-44f3-9211-b4b65c75d8a4.png)\n\n**不管前台还是后台，配置了域名就使用域名访问，没配置就使用ip+端口也可以！！！**\n# 6.部署常见问题\n## 6.1\n![](https://image.kuailemao.xyz/blog/article/articleImage/e56dc4e4-bc0f-4274-a385-d49eb5278bf1.jpeg)\n\n**解决：**\n> 检查自己前台env配置文件配置是否正确\n\n\n# 7.最后\n**如果你以上都成功了，那么恭喜你，成功部署了我的博客项目！！！**\n因为群里面可能小白毕竟多，这份部署文档可能就写的比较详细，我也花了很多心思，每个服务其实都有很多不同的部署方法，我在这里选择了最简单，最不容易出错的 Docker 容器的部署方法，如果有大佬的话就适当跳过就好了，如果发现有问题或者有什么缺陷，大家都可以在交流群里面提出来。\n这个项目花费了我大量精力，项目不敢保证一定没有问题，但是会持续优化更新，大家也可以在群里面提建议。\n**在这里也感谢各位的支持与认可，如果可以，希望能给小弟两颗星星，开源不易，感谢大家！！！**\n**gitee&github地址：**\n[https://gitee.com/kuailemao/ruyu-blog](https://gitee.com/kuailemao/ruyu-blog)\n[https://github.com/kuailemao/Ruyu-Blog](https://github.com/kuailemao/Ruyu-Blog)\n\n\n\n'
    content.value = articleContent
    articleTitle.value = '测试文章'
  }

  const scrollToTop = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }
</script>

<style lang="scss">
  .article-detail {
    .content {
      max-width: 800px;
      margin: auto;
      margin-top: 60px;

      .markdown-body {
        margin-top: 60px;

        img {
          width: 100%;
          border: 1px solid var(--art-gray-200);
        }

        pre {
          position: relative;

          &:hover {
            .copy-button {
              opacity: 1;
            }
          }

          &::before {
            position: absolute;
            top: 0;
            left: 50px;
            width: 1px;
            height: 100%;
            content: '';
            background: #0a0a0e;
          }
        }

        .line-number {
          box-sizing: border-box;
          display: inline-block;
          width: 50px;
          margin-right: 10px;
          font-size: 14px;
          color: #9e9e9e;
          text-align: center;
        }

        .copy-button {
          position: absolute;
          top: 10px;
          right: 10px;
          z-index: 1;
          width: 40px;
          height: 40px;
          font-size: 20px;
          line-height: 40px;
          color: #999;
          text-align: center;
          cursor: pointer;
          background-color: #000;
          border: none;
          border-radius: 8px;
          opacity: 0;
          transition: all 0.2s;
        }
      }
    }
  }
</style>
